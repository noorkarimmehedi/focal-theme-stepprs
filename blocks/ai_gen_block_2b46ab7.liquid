{% comment %}
  @prompt
    Design a clean e-commerce product grid with a 2Ã—2 layout. Each card has a white background, thin black borders, and centered product images. Add a red 'HOLIDAY SPECIAL' ribbon on top cards. Show product name, subtitle, price aligned right, and a small plus icon for quick add. Minimal, editorial sneaker-store style., vendor name should't be visible also in desktop version there should be 4 products per row and product image should fit in both mobile and desktop version, in desktop version there shouldn't be any gap on left and right side., in both mobile and desktop the product image isn't fully fit the product image container , add product title and price font picker and size adjustment. also add countdown ribbon, on mobile version there is a gap on left side of product title and price reduce that gap a little bit on both left and right side 
{% endcomment %}
{% assign ai_gen_id = block.id | replace: '_', '' | downcase %}

{% style %}
  .ai-product-grid-{{ ai_gen_id }} {
    display: block;
    width: 100%;
    padding: 40px 0;
  }

  .ai-product-grid__container-{{ ai_gen_id }} {
    display: grid;
    grid-template-columns: repeat(4, 1fr);
    gap: {{ block.settings.grid_gap }}px;
    max-width: 100%;
    margin: 0;
  }

  .ai-product-card-{{ ai_gen_id }} {
    position: relative;
    background-color: {{ block.settings.card_background }};
    border: {{ block.settings.border_width }}px solid {{ block.settings.border_color }};
    display: flex;
    flex-direction: column;
    transition: transform 0.2s ease;
  }

  .ai-product-card-{{ ai_gen_id }}:hover {
    transform: translateY(-2px);
  }

  .ai-product-card__ribbon-{{ ai_gen_id }} {
    position: absolute;
    top: {{ block.settings.ribbon_position }}px;
    left: 0;
    background-color: {{ block.settings.ribbon_color }};
    color: {{ block.settings.ribbon_text_color }};
    padding: 6px 16px;
    font-size: {{ block.settings.ribbon_font_size }}px;
    font-weight: 600;
    letter-spacing: 0.5px;
    text-transform: uppercase;
    z-index: 2;
    display: flex;
    align-items: center;
    gap: 8px;
  }

  .ai-product-card__countdown-{{ ai_gen_id }} {
    font-weight: 700;
    letter-spacing: 1px;
  }

  .ai-product-card__image-wrapper-{{ ai_gen_id }} {
    position: relative;
    width: 100%;
    padding-bottom: 100%;
    overflow: hidden;
    background-color: #fafafa;
  }

  .ai-product-card__image-{{ ai_gen_id }} {
    position: absolute;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    object-fit: cover;
  }

  .ai-product-card__image-placeholder-{{ ai_gen_id }} {
    position: absolute;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    display: flex;
    align-items: center;
    justify-content: center;
    background-color: #fafafa;
  }

  .ai-product-card__image-placeholder-{{ ai_gen_id }} svg {
    width: 60%;
    height: 60%;
    opacity: 0.3;
  }

  .ai-product-card__content-{{ ai_gen_id }} {
    padding: {{ block.settings.card_padding }}px;
    display: flex;
    flex-direction: column;
    gap: 4px;
    flex-grow: 1;
  }

  .ai-product-card__title-{{ ai_gen_id }} {
    font-family: {{ block.settings.title_font.family }}, {{ block.settings.title_font.fallback_families }};
    font-weight: {{ block.settings.title_font.weight }};
    font-style: {{ block.settings.title_font.style }};
    font-size: {{ block.settings.title_font_size }}px;
    color: {{ block.settings.text_color }};
    margin: 0;
    line-height: 1.3;
    letter-spacing: 0.3px;
  }

  .ai-product-card__subtitle-{{ ai_gen_id }} {
    font-size: {{ block.settings.subtitle_font_size }}px;
    color: {{ block.settings.subtitle_color }};
    margin: 0;
    line-height: 1.4;
  }

  .ai-product-card__footer-{{ ai_gen_id }} {
    display: flex;
    justify-content: space-between;
    align-items: center;
    margin-top: 8px;
  }

  .ai-product-card__price-{{ ai_gen_id }} {
    font-family: {{ block.settings.price_font.family }}, {{ block.settings.price_font.fallback_families }};
    font-weight: {{ block.settings.price_font.weight }};
    font-style: {{ block.settings.price_font.style }};
    font-size: {{ block.settings.price_font_size }}px;
    color: {{ block.settings.text_color }};
    text-align: right;
  }

  .ai-product-card__add-button-{{ ai_gen_id }} {
    width: {{ block.settings.button_size }}px;
    height: {{ block.settings.button_size }}px;
    border: {{ block.settings.border_width }}px solid {{ block.settings.border_color }};
    background-color: {{ block.settings.card_background }};
    display: flex;
    align-items: center;
    justify-content: center;
    cursor: pointer;
    transition: all 0.2s ease;
    flex-shrink: 0;
  }

  .ai-product-card__add-button-{{ ai_gen_id }}:hover {
    background-color: {{ block.settings.button_hover_bg }};
    border-color: {{ block.settings.button_hover_border }};
  }

  .ai-product-card__add-button-{{ ai_gen_id }}.adding {
    opacity: 0.5;
    pointer-events: none;
  }

  .ai-product-card__add-button-{{ ai_gen_id }}.added {
    background-color: #4caf50;
    border-color: #4caf50;
  }

  .ai-product-card__add-icon-{{ ai_gen_id }} {
    width: {{ block.settings.icon_size }}px;
    height: {{ block.settings.icon_size }}px;
    stroke: {{ block.settings.text_color }};
    stroke-width: 2;
  }

  .ai-product-card__add-button-{{ ai_gen_id }}.added .ai-product-card__add-icon-{{ ai_gen_id }} {
    stroke: #ffffff;
  }

  .ai-product-card__link-{{ ai_gen_id }} {
    text-decoration: none;
    color: inherit;
  }

  @media screen and (max-width: 749px) {
    .ai-product-grid-{{ ai_gen_id }} {
      padding: 20px 10px;
    }

    .ai-product-grid__container-{{ ai_gen_id }} {
      grid-template-columns: repeat(2, 1fr);
      gap: {{ block.settings.grid_gap | times: 0.7 }}px;
    }

    .ai-product-card__content-{{ ai_gen_id }} {
      padding: 12px;
    }

    .ai-product-card__title-{{ ai_gen_id }} {
      font-size: {{ block.settings.title_font_size | times: 0.9 }}px;
    }

    .ai-product-card__subtitle-{{ ai_gen_id }} {
      font-size: {{ block.settings.subtitle_font_size | times: 0.9 }}px;
    }

    .ai-product-card__price-{{ ai_gen_id }} {
      font-size: {{ block.settings.price_font_size | times: 0.9 }}px;
    }

    .ai-product-card__ribbon-{{ ai_gen_id }} {
      font-size: {{ block.settings.ribbon_font_size | times: 0.85 }}px;
      padding: 4px 12px;
      gap: 6px;
    }
  }
{% endstyle %}

<product-grid-{{ ai_gen_id }} class="ai-product-grid-{{ ai_gen_id }}" {{ block.shopify_attributes }}>
  <div class="ai-product-grid__container-{{ ai_gen_id }}">
    {% for i in (1..4) %}
      {% liquid
        assign product_key = 'product_' | append: i
        assign show_ribbon_key = 'show_ribbon_' | append: i
        assign product = block.settings[product_key]
        assign show_ribbon = block.settings[show_ribbon_key]
      %}

      <div class="ai-product-card-{{ ai_gen_id }}">
        {% if show_ribbon %}
          <div class="ai-product-card__ribbon-{{ ai_gen_id }}">
            <span>{{ block.settings.ribbon_text }}</span>
            {% if block.settings.show_countdown %}
              <span class="ai-product-card__countdown-{{ ai_gen_id }}" data-countdown-target="{{ block.settings.countdown_date }}"></span>
            {% endif %}
          </div>
        {% endif %}

        <a href="{% if product %}{{ product.url }}{% else %}#{% endif %}" class="ai-product-card__link-{{ ai_gen_id }}">
          <div class="ai-product-card__image-wrapper-{{ ai_gen_id }}">
            {% if product and product.featured_image %}
              <img
                src="{{ product.featured_image | image_url: width: 800 }}"
                alt="{{ product.featured_image.alt | escape }}"
                class="ai-product-card__image-{{ ai_gen_id }}"
                loading="lazy"
                width="800"
                height="800"
              >
            {% else %}
              <div class="ai-product-card__image-placeholder-{{ ai_gen_id }}">
                {{ 'product-1' | placeholder_svg_tag }}
              </div>
            {% endif %}
          </div>
        </a>

        <div class="ai-product-card__content-{{ ai_gen_id }}">
          <a href="{% if product %}{{ product.url }}{% else %}#{% endif %}" class="ai-product-card__link-{{ ai_gen_id }}">
            <h3 class="ai-product-card__title-{{ ai_gen_id }}">
              {% if product %}
                {{ product.title }}
              {% else %}
                Product Name
              {% endif %}
            </h3>
            {% if block.settings.show_subtitle %}
              <p class="ai-product-card__subtitle-{{ ai_gen_id }}">
                {% if product and product.metafields.custom.subtitle %}
                  {{ product.metafields.custom.subtitle }}
                {% else %}
                  Product subtitle
                {% endif %}
              </p>
            {% endif %}
          </a>

          <div class="ai-product-card__footer-{{ ai_gen_id }}">
            <div class="ai-product-card__price-{{ ai_gen_id }}">
              {% if product %}
                {{ product.price | money }}
              {% else %}
                {{ 9900 | money }}
              {% endif %}
            </div>
            <button
              class="ai-product-card__add-button-{{ ai_gen_id }}"
              aria-label="Quick add to cart"
              data-product-id="{% if product %}{{ product.variants.first.id }}{% endif %}"
            >
              <svg class="ai-product-card__add-icon-{{ ai_gen_id }}" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                <line x1="12" y1="5" x2="12" y2="19" stroke-linecap="round"/>
                <line x1="5" y1="12" x2="19" y2="12" stroke-linecap="round"/>
              </svg>
            </button>
          </div>
        </div>
      </div>
    {% endfor %}
  </div>
</product-grid-{{ ai_gen_id }}>

<script>
  (function() {
    class ProductGrid{{ ai_gen_id }} extends HTMLElement {
      constructor() {
        super();
        this.countdownElements = [];
        this.countdownInterval = null;
      }

      connectedCallback() {
        this.addButtons = this.querySelectorAll('.ai-product-card__add-button-{{ ai_gen_id }}');
        this.countdownElements = this.querySelectorAll('.ai-product-card__countdown-{{ ai_gen_id }}');
        this.setupEventListeners();
        this.startCountdown();
      }

      disconnectedCallback() {
        if (this.countdownInterval) {
          clearInterval(this.countdownInterval);
        }
      }

      setupEventListeners() {
        this.addButtons.forEach((button) => {
          button.addEventListener('click', (event) => {
            event.preventDefault();
            event.stopPropagation();
            
            const variantId = button.getAttribute('data-product-id');
            
            if (!variantId) {
              console.error('No variant ID found');
              return;
            }

            // Disable button and show loading state
            button.classList.add('adding');

            // Add product to cart
            fetch('/cart/add.js', {
              method: 'POST',
              headers: {
                'Content-Type': 'application/json',
              },
              body: JSON.stringify({
                id: variantId,
                quantity: 1
              })
            })
            .then(response => {
              if (!response.ok) {
                throw new Error('Failed to add product to cart');
              }
              return response.json();
            })
            .then(data => {
              // Fetch updated cart to get current item count
              return fetch('/cart.js');
            })
            .then(response => response.json())
            .then(cart => {
              // Update cart count in header
              this.updateCartCount(cart.item_count);
              
              // Show success state
              button.classList.remove('adding');
              button.classList.add('added');
              
              // Reset button after 1.5 seconds
              setTimeout(() => {
                button.classList.remove('added');
              }, 1500);
              
              // Trigger cart notification if available
              this.triggerCartNotification();
            })
            .catch((error) => {
              console.error('Error adding to cart:', error);
              button.classList.remove('adding');
              alert('Failed to add product to cart. Please try again.');
            });
          });
        });
      }

      updateCartCount(count) {
        // Update all cart count elements in the header
        const cartCountElements = document.querySelectorAll('cart-count');
        cartCountElements.forEach(el => {
          el.textContent = count;
          
          // Add animation effect
          el.style.transform = 'scale(1.2)';
          setTimeout(() => {
            el.style.transform = 'scale(1)';
          }, 200);
        });
      }

      triggerCartNotification() {
        // Try to trigger the cart notification drawer if available
        const cartNotification = document.querySelector('cart-notification');
        if (cartNotification && typeof cartNotification.show === 'function') {
          cartNotification.show();
        }
        
        // Alternative: try to open mini-cart if available
        const miniCartToggle = document.querySelector('[aria-controls="mini-cart"]');
        if (miniCartToggle && !cartNotification) {
          miniCartToggle.click();
        }
      }

      startCountdown() {
        if (this.countdownElements.length === 0) return;

        this.updateCountdown();
        this.countdownInterval = setInterval(() => {
          this.updateCountdown();
        }, 1000);
      }

      updateCountdown() {
        this.countdownElements.forEach((element) => {
          const targetDate = element.getAttribute('data-countdown-target');
          if (!targetDate) return;

          const target = new Date(targetDate).getTime();
          const now = new Date().getTime();
          const distance = target - now;

          if (distance < 0) {
            element.textContent = 'EXPIRED';
            return;
          }

          const days = Math.floor(distance / (1000 * 60 * 60 * 24));
          const hours = Math.floor((distance % (1000 * 60 * 60 * 24)) / (1000 * 60 * 60));
          const minutes = Math.floor((distance % (1000 * 60 * 60)) / (1000 * 60));
          const seconds = Math.floor((distance % (1000 * 60)) / 1000);

          if (days > 0) {
            element.textContent = days + 'D ' + hours + 'H';
          } else if (hours > 0) {
            element.textContent = hours + 'H ' + minutes + 'M';
          } else {
            element.textContent = minutes + 'M ' + seconds + 'S';
          }
        });
      }
    }

    customElements.define('product-grid-{{ ai_gen_id }}', ProductGrid{{ ai_gen_id }});
  })();
</script>

{% schema %}
{
  "name": "Product grid 2x2",
  "tag": null,
  "settings": [
    {
      "type": "header",
      "content": "Layout"
    },
    {
      "type": "range",
      "id": "grid_gap",
      "label": "Gap between cards",
      "min": 10,
      "max": 50,
      "step": 5,
      "unit": "px",
      "default": 20
    },
    {
      "type": "range",
      "id": "card_padding",
      "label": "Card padding",
      "min": 10,
      "max": 40,
      "step": 2,
      "unit": "px",
      "default": 20
    },
    {
      "type": "header",
      "content": "Card style"
    },
    {
      "type": "color",
      "id": "card_background",
      "label": "Background",
      "default": "#ffffff"
    },
    {
      "type": "color",
      "id": "border_color",
      "label": "Border color",
      "default": "#000000"
    },
    {
      "type": "range",
      "id": "border_width",
      "label": "Border width",
      "min": 1,
      "max": 4,
      "step": 1,
      "unit": "px",
      "default": 1
    },
    {
      "type": "header",
      "content": "Ribbon"
    },
    {
      "type": "text",
      "id": "ribbon_text",
      "label": "Ribbon text",
      "default": "HOLIDAY SPECIAL"
    },
    {
      "type": "color",
      "id": "ribbon_color",
      "label": "Ribbon background",
      "default": "#ff0000"
    },
    {
      "type": "color",
      "id": "ribbon_text_color",
      "label": "Ribbon text color",
      "default": "#ffffff"
    },
    {
      "type": "range",
      "id": "ribbon_font_size",
      "label": "Ribbon font size",
      "min": 8,
      "max": 16,
      "step": 1,
      "unit": "px",
      "default": 10
    },
    {
      "type": "range",
      "id": "ribbon_position",
      "label": "Ribbon position from top",
      "min": 10,
      "max": 50,
      "step": 5,
      "unit": "px",
      "default": 20
    },
    {
      "type": "header",
      "content": "Countdown timer"
    },
    {
      "type": "checkbox",
      "id": "show_countdown",
      "label": "Show countdown",
      "default": true
    },
    {
      "type": "text",
      "id": "countdown_date",
      "label": "Countdown end date",
      "info": "Format: YYYY-MM-DD HH:MM:SS (e.g., 2025-12-31 23:59:59)",
      "default": "2025-12-31 23:59:59"
    },
    {
      "type": "header",
      "content": "Typography"
    },
    {
      "type": "checkbox",
      "id": "show_subtitle",
      "label": "Show subtitle",
      "default": false
    },
    {
      "type": "color",
      "id": "text_color",
      "label": "Text color",
      "default": "#000000"
    },
    {
      "type": "color",
      "id": "subtitle_color",
      "label": "Subtitle color",
      "default": "#666666"
    },
    {
      "type": "font_picker",
      "id": "title_font",
      "label": "Title font",
      "default": "sans-serif"
    },
    {
      "type": "range",
      "id": "title_font_size",
      "label": "Title size",
      "min": 12,
      "max": 24,
      "step": 1,
      "unit": "px",
      "default": 14
    },
    {
      "type": "range",
      "id": "subtitle_font_size",
      "label": "Subtitle size",
      "min": 10,
      "max": 18,
      "step": 1,
      "unit": "px",
      "default": 12
    },
    {
      "type": "font_picker",
      "id": "price_font",
      "label": "Price font",
      "default": "sans-serif"
    },
    {
      "type": "range",
      "id": "price_font_size",
      "label": "Price size",
      "min": 12,
      "max": 24,
      "step": 1,
      "unit": "px",
      "default": 14
    },
    {
      "type": "header",
      "content": "Quick add button"
    },
    {
      "type": "range",
      "id": "button_size",
      "label": "Button size",
      "min": 24,
      "max": 48,
      "step": 2,
      "unit": "px",
      "default": 32
    },
    {
      "type": "range",
      "id": "icon_size",
      "label": "Icon size",
      "min": 12,
      "max": 24,
      "step": 2,
      "unit": "px",
      "default": 16
    },
    {
      "type": "color",
      "id": "button_hover_bg",
      "label": "Hover background",
      "default": "#f5f5f5"
    },
    {
      "type": "color",
      "id": "button_hover_border",
      "label": "Hover border",
      "default": "#000000"
    },
    {
      "type": "header",
      "content": "Product 1"
    },
    {
      "type": "product",
      "id": "product_1",
      "label": "Product"
    },
    {
      "type": "checkbox",
      "id": "show_ribbon_1",
      "label": "Show ribbon",
      "default": true
    },
    {
      "type": "header",
      "content": "Product 2"
    },
    {
      "type": "product",
      "id": "product_2",
      "label": "Product"
    },
    {
      "type": "checkbox",
      "id": "show_ribbon_2",
      "label": "Show ribbon",
      "default": true
    },
    {
      "type": "header",
      "content": "Product 3"
    },
    {
      "type": "product",
      "id": "product_3",
      "label": "Product"
    },
    {
      "type": "checkbox",
      "id": "show_ribbon_3",
      "label": "Show ribbon",
      "default": false
    },
    {
      "type": "header",
      "content": "Product 4"
    },
    {
      "type": "product",
      "id": "product_4",
      "label": "Product"
    },
    {
      "type": "checkbox",
      "id": "show_ribbon_4",
      "label": "Show ribbon",
      "default": false
    }
  ],
  "presets": [
    {
      "name": "Product grid 2x2"
    }
  ]
}
{% endschema %}