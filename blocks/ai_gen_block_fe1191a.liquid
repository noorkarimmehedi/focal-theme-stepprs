{% comment %}
  Interactive Details & Image Hero Section
  Features expandable details with synchronized image carousel
{% endcomment %}

{% assign section_id = section.id | replace: '_', '' | downcase %}

{% style %}
  /* Base Variables */
  .section-{{ section_id }} {
    --ease: cubic-bezier(.42,0,.58,1);
    --bounce: linear(
      0 0%, 0.4214 6.61%, 0.5762 9.59%,
      0.7047 12.55%, 0.8115 15.61%,
      0.8964 18.78%, 0.9614 22.13%,
      1.0078 25.74%, 1.0282 28.18%,
      1.0422 30.82%, 1.0503 33.7%,
      1.0527 36.95%, 1.0468 42.53%,
      1.015 58.45%, 1.0045 67.2%,
      0.9987 80.44%, 1 100%
    );
    --speed: {{ section.settings.animation_speed }}s;
    --width: {{ section.settings.details_width }}px;
    --sizing: {{ section.settings.button_height }}px;
    --distance: 15%;
    --background: {{ section.settings.button_background }};
    --hover-background: {{ section.settings.button_hover_background }};
  }

  /* Main Section */
  .section-{{ section_id }} .hero-wrapper {
    margin: {{ section.settings.section_margin }}px auto;
    display: flex;
    place-items: center;
    gap: 1rem;
    position: relative;
    min-height: {{ section.settings.min_height }}px;
    aspect-ratio: 4 / 3;
    justify-content: flex-start;
    overflow: hidden;
    max-width: calc(100vw - 2rem);
    width: {{ section.settings.max_width }}px;
    border-radius: {{ section.settings.border_radius }}px;
    background: {{ section.settings.background_color }};
    border: 2px solid {{ section.settings.border_color }};
  }

  /* Details Column */
  .section-{{ section_id }} .details-column {
    padding-left: 4rem;
    display: grid;
    grid-auto-rows: auto;
    width: var(--width);
    place-items: center;
    justify-items: start;
    gap: 0.5rem;
    z-index: 20;
    flex: 1 0 var(--width);
  }

  /* Image Column */
  .section-{{ section_id }} .image-column {
    width: 100%;
    height: 100%;
    position: relative;
    display: grid;
    place-items: center;
    pointer-events: none;
  }

  .section-{{ section_id }} .img-block {
    position: absolute;
    inset: 0;
  }

  .section-{{ section_id }} .img-wrapper {
    width: 100%;
    height: 100%;
    display: inline-block;
    transform: translateX(0);
    transition-property: transform, opacity, scale;
    transition-duration: calc(var(--speed) * 0), calc(var(--speed) * 0.35), calc(var(--speed) * 1.15);
    transition-timing-function: var(--ease), var(--ease), var(--bounce);
    transform-origin: 100% 150%;
  }

  .section-{{ section_id }} .img-wrapper img {
    position: absolute;
    top: 0;
    right: 0;
    bottom: 0;
    aspect-ratio: 1;
    height: 100%;
    width: 100%;
    object-fit: cover;
  }

  /* Image positioning states */
  .section-{{ section_id }} .img-block:nth-of-type(1) {
    z-index: 10;
  }

  .section-{{ section_id }} .img-block:nth-of-type(1) .img-wrapper {
    transform-origin: 50% 50%;
    transition-duration: calc(var(--speed) * .4), calc(var(--speed) * 0.35), calc(var(--speed) * 1.15);
    transition-timing-function: ease-in, var(--ease), var(--bounce);
  }

  /* Active image states */
  .section-{{ section_id }} .hero-wrapper:has(details:nth-of-type(1)[open]) .image-column .img-block:nth-of-type(2),
  .section-{{ section_id }} .hero-wrapper:has(details:nth-of-type(2)[open]) .image-column .img-block:nth-of-type(3),
  .section-{{ section_id }} .hero-wrapper:has(details:nth-of-type(3)[open]) .image-column .img-block:nth-of-type(4),
  .section-{{ section_id }} .hero-wrapper:has(details:nth-of-type(4)[open]) .image-column .img-block:nth-of-type(5),
  .section-{{ section_id }} .hero-wrapper:has(details:nth-of-type(5)[open]) .image-column .img-block:nth-of-type(6),
  .section-{{ section_id }} .hero-wrapper:has(details:nth-of-type(6)[open]) .image-column .img-block:nth-of-type(7) {
    translate: var(--distance) 0;
    z-index: 2;
  }

  .section-{{ section_id }} .hero-wrapper:has(details:nth-of-type(1)[open]) .image-column .img-block:nth-of-type(2) .img-wrapper,
  .section-{{ section_id }} .hero-wrapper:has(details:nth-of-type(2)[open]) .image-column .img-block:nth-of-type(3) .img-wrapper,
  .section-{{ section_id }} .hero-wrapper:has(details:nth-of-type(3)[open]) .image-column .img-block:nth-of-type(4) .img-wrapper,
  .section-{{ section_id }} .hero-wrapper:has(details:nth-of-type(4)[open]) .image-column .img-block:nth-of-type(5) .img-wrapper,
  .section-{{ section_id }} .hero-wrapper:has(details:nth-of-type(5)[open]) .image-column .img-block:nth-of-type(6) .img-wrapper,
  .section-{{ section_id }} .hero-wrapper:has(details:nth-of-type(6)[open]) .image-column .img-block:nth-of-type(7) .img-wrapper {
    transform: translateX(calc(var(--distance) * -1));
    transition-delay: calc(var(--speed) * 0.2);
  }

  /* Inactive image states */
  .section-{{ section_id }} .hero-wrapper:not(:has(details:nth-of-type(1)[open])) .image-column .img-block:nth-of-type(2) .img-wrapper,
  .section-{{ section_id }} .hero-wrapper:not(:has(details:nth-of-type(2)[open])) .image-column .img-block:nth-of-type(3) .img-wrapper,
  .section-{{ section_id }} .hero-wrapper:not(:has(details:nth-of-type(3)[open])) .image-column .img-block:nth-of-type(4) .img-wrapper,
  .section-{{ section_id }} .hero-wrapper:not(:has(details:nth-of-type(4)[open])) .image-column .img-block:nth-of-type(5) .img-wrapper,
  .section-{{ section_id }} .hero-wrapper:not(:has(details:nth-of-type(5)[open])) .image-column .img-block:nth-of-type(6) .img-wrapper,
  .section-{{ section_id }} .hero-wrapper:not(:has(details:nth-of-type(6)[open])) .image-column .img-block:nth-of-type(7) .img-wrapper {
    transition-property: translate, opacity, scale;
    transition-timing-function: ease-in, ease-out, ease-in;
    translate: 0 0;
    scale: 0.9;
    opacity: 0;
  }

  /* First image special case */
  .section-{{ section_id }} .hero-wrapper:not(:has([open])) .image-column .img-block:first-of-type .img-wrapper {
    transform: translateX(0%);
    transition-delay: calc(var(--speed) * 0.2);
  }

  .section-{{ section_id }} .hero-wrapper:has([open]) .image-column .img-block:first-of-type .img-wrapper {
    translate: 0 0;
    scale: 1.25;
    opacity: 0;
  }

  /* Details Styling */
  .section-{{ section_id }} details {
    display: inline-block;
    border-radius: calc(var(--sizing) * 0.5);
    overflow: hidden;
    min-height: var(--sizing);
    background: var(--background);
    backdrop-filter: blur(20px) saturate(180%);
    color: {{ section.settings.text_color }};
    transition: background 0.2s var(--ease);
  }

  .section-{{ section_id }} details:hover:not([open]) {
    background: var(--hover-background);
  }

  .section-{{ section_id }} summary {
    display: inline-flex;
    gap: 0.5rem;
    align-items: center;
    padding: 1.5rem;
    border-radius: calc(var(--sizing) * 0.5);
    height: var(--sizing);
    min-height: var(--sizing);
    cursor: pointer;
    z-index: 20;
    position: relative;
    transition-property: opacity, width;
    transition-duration: calc(var(--speed) * 0.5), calc(var(--speed) * 1.5);
    transition-timing-function: var(--ease), var(--bounce);
    transition-delay: calc(var(--speed) * 1.05), 0s;
    white-space: nowrap;
    font-weight: 600;
    font-size: {{ section.settings.summary_font_size }}px;
    list-style: none;
  }

  .section-{{ section_id }} summary::-webkit-details-marker {
    display: none;
  }

  .section-{{ section_id }} summary svg {
    width: 24px;
    aspect-ratio: 1;
    flex-shrink: 0;
  }

  .section-{{ section_id }} [open] summary {
    opacity: 0;
    pointer-events: none;
    transition-delay: 0s;
    width: var(--width);
  }

  .section-{{ section_id }} .details-content {
    width: var(--width);
    min-height: var(--sizing);
    padding: 1.5rem;
    font-size: {{ section.settings.content_font_size }}px;
    line-height: 1.6;
  }

  .section-{{ section_id }} .details-content p {
    margin: 0;
  }

  .section-{{ section_id }} .details-content a {
    color: {{ section.settings.link_color }};
    text-decoration: underline;
  }

  /* Navigation Controls */
  .section-{{ section_id }} [data-action] {
    display: grid;
    place-items: center;
    width: 36px;
    aspect-ratio: 1;
    border: 0;
    cursor: pointer;
    padding: 0;
    border-radius: 50%;
    background: var(--background);
    transition: opacity 0.26s var(--ease), background 0.26s var(--ease), transform 0.26s var(--ease);
    z-index: 20;
    position: absolute;
  }

  .section-{{ section_id }} [data-action]:hover {
    background: var(--hover-background);
  }

  .section-{{ section_id }} [data-action] svg {
    width: 22px;
    color: {{ section.settings.text_color }};
    stroke-width: 3;
  }

  .section-{{ section_id }} [data-action="next"],
  .section-{{ section_id }} [data-action="previous"] {
    top: 50%;
    left: 1rem;
  }

  .section-{{ section_id }} [data-action="previous"] {
    translate: 0 -150%;
  }

  .section-{{ section_id }} [data-action="next"] {
    translate: 0 50%;
  }

  .section-{{ section_id }} [data-action="next"] svg {
    rotate: 180deg;
  }

  .section-{{ section_id }} [data-action="exit"] {
    right: 1rem;
    top: 1rem;
  }

  .section-{{ section_id }} [data-action="exit"] svg {
    rotate: 45deg;
  }

  .section-{{ section_id }} .hero-wrapper:not(:has([open])) [data-action] {
    opacity: 0;
    transform: translateY(1rem);
    pointer-events: none;
  }

  /* Responsive */
  @media screen and (max-width: 989px) {
    .section-{{ section_id }} .hero-wrapper {
      flex-direction: column;
      aspect-ratio: auto;
      min-height: 600px;
    }

    .section-{{ section_id }} .details-column {
      padding-left: 2rem;
      width: 100%;
    }

    .section-{{ section_id }} .image-column {
      height: 400px;
    }
  }

  @media screen and (max-width: 749px) {
    .section-{{ section_id }} .hero-wrapper {
      min-height: 500px;
    }

    .section-{{ section_id }} .details-column {
      padding-left: 1rem;
    }

    .section-{{ section_id }} summary {
      font-size: {{ section.settings.summary_font_size | times: 0.9 }}px;
    }
  }
{% endstyle %}

<div class="section-{{ section_id }}" {{ section.shopify_attributes }}>
  <div class="hero-wrapper" id="hero-{{ section_id }}">
    <div class="details-column">
      {% for i in (1..6) %}
        {% liquid
          assign feature_enabled_key = 'feature_' | append: i | append: '_enabled'
          assign feature_title_key = 'feature_' | append: i | append: '_title'
          assign feature_content_key = 'feature_' | append: i | append: '_content'
          assign feature_enabled = section.settings[feature_enabled_key]
          assign feature_title = section.settings[feature_title_key]
          assign feature_content = section.settings[feature_content_key]
        %}

        {% if feature_enabled and feature_title != blank %}
          <details name="feature-{{ section_id }}">
            <summary>
              <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor">
                <path stroke-linecap="round" stroke-linejoin="round" d="M12 9v6m3-3H9m12 0a9 9 0 1 1-18 0 9 9 0 0 1 18 0Z" />
              </svg>
              <span>{{ feature_title }}</span>
            </summary>
            <div class="details-content">
              {{ feature_content }}
            </div>
          </details>
        {% endif %}
      {% endfor %}
    </div>

    <div class="image-column">
      {% if section.settings.default_image %}
        <div class="img-block">
          <div class="img-wrapper">
            <img
              src="{{ section.settings.default_image | image_url: width: 1200 }}"
              alt="{{ section.settings.default_image.alt | escape }}"
              loading="lazy"
            >
          </div>
        </div>
      {% endif %}

      {% for i in (1..6) %}
        {% liquid
          assign feature_enabled_key = 'feature_' | append: i | append: '_enabled'
          assign feature_image_key = 'feature_' | append: i | append: '_image'
          assign feature_enabled = section.settings[feature_enabled_key]
          assign feature_image = section.settings[feature_image_key]
        %}

        {% if feature_enabled and feature_image %}
          <div class="img-block">
            <div class="img-wrapper">
              <img
                src="{{ feature_image | image_url: width: 1200 }}"
                alt="{{ feature_image.alt | escape }}"
                loading="lazy"
              >
            </div>
          </div>
        {% endif %}
      {% endfor %}
    </div>

    <button aria-label="Next feature" data-action="next">
      <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor">
        <path stroke-linecap="round" stroke-linejoin="round" d="m4.5 15.75 7.5-7.5 7.5 7.5" />
      </svg>
    </button>
    <button aria-label="Previous feature" data-action="previous">
      <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor">
        <path stroke-linecap="round" stroke-linejoin="round" d="m4.5 15.75 7.5-7.5 7.5 7.5" />
      </svg>
    </button>
    <button aria-label="Close" data-action="exit">
      <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor">
        <path stroke-linecap="round" stroke-linejoin="round" d="M12 4.5v15m7.5-7.5h-15" />
      </svg>
    </button>
  </div>
</div>

<script>
  (function() {
    const section = document.getElementById('hero-{{ section_id }}');
    const detailsElements = section.querySelectorAll('details[name="feature-{{ section_id }}"]');
    const nextButton = section.querySelector('[data-action="next"]');
    const previousButton = section.querySelector('[data-action="previous"]');
    const exitButton = section.querySelector('[data-action="exit"]');

    const getOpenDetails = () => {
      return Array.from(detailsElements).findIndex(details => details.open);
    };

    nextButton?.addEventListener('click', () => {
      const currentIndex = getOpenDetails();
      if (currentIndex !== -1) {
        detailsElements[currentIndex].open = false;
        const nextIndex = (currentIndex + 1) % detailsElements.length;
        detailsElements[nextIndex].open = true;
      }
    });

    previousButton?.addEventListener('click', () => {
      const currentIndex = getOpenDetails();
      if (currentIndex !== -1) {
        detailsElements[currentIndex].open = false;
        const previousIndex = (currentIndex - 1 + detailsElements.length) % detailsElements.length;
        detailsElements[previousIndex].open = true;
      }
    });

    exitButton?.addEventListener('click', () => {
      const currentIndex = getOpenDetails();
      if (currentIndex !== -1) {
        detailsElements[currentIndex].open = false;
      }
    });
  })();
</script>

{% schema %}
{
  "name": "Interactive Details Hero",
  "settings": [
    {
      "type": "header",
      "content": "Layout"
    },
    {
      "type": "range",
      "id": "max_width",
      "min": 600,
      "max": 1400,
      "step": 50,
      "unit": "px",
      "label": "Maximum width",
      "default": 800
    },
    {
      "type": "range",
      "id": "min_height",
      "min": 400,
      "max": 800,
      "step": 50,
      "unit": "px",
      "label": "Minimum height",
      "default": 500
    },
    {
      "type": "range",
      "id": "section_margin",
      "min": 0,
      "max": 100,
      "step": 10,
      "unit": "px",
      "label": "Section margin",
      "default": 40
    },
    {
      "type": "range",
      "id": "border_radius",
      "min": 0,
      "max": 50,
      "step": 2,
      "unit": "px",
      "label": "Border radius",
      "default": 16
    },
    {
      "type": "range",
      "id": "details_width",
      "min": 250,
      "max": 400,
      "step": 10,
      "unit": "px",
      "label": "Details panel width",
      "default": 300
    },
    {
      "type": "range",
      "id": "button_height",
      "min": 40,
      "max": 80,
      "step": 2,
      "unit": "px",
      "label": "Button height",
      "default": 56
    },
    {
      "type": "header",
      "content": "Colors"
    },
    {
      "type": "color",
      "id": "background_color",
      "label": "Background",
      "default": "#000000"
    },
    {
      "type": "color",
      "id": "border_color",
      "label": "Border",
      "default": "#333333"
    },
    {
      "type": "color",
      "id": "button_background",
      "label": "Button background",
      "default": "rgba(10, 10, 10, 0.75)"
    },
    {
      "type": "color",
      "id": "button_hover_background",
      "label": "Button hover background",
      "default": "rgba(40, 40, 40, 0.75)"
    },
    {
      "type": "color",
      "id": "text_color",
      "label": "Text color",
      "default": "#ffffff"
    },
    {
      "type": "color",
      "id": "link_color",
      "label": "Link color",
      "default": "#4a9eff"
    },
    {
      "type": "header",
      "content": "Typography"
    },
    {
      "type": "range",
      "id": "summary_font_size",
      "min": 14,
      "max": 24,
      "step": 1,
      "unit": "px",
      "label": "Summary font size",
      "default": 16
    },
    {
      "type": "range",
      "id": "content_font_size",
      "min": 12,
      "max": 20,
      "step": 1,
      "unit": "px",
      "label": "Content font size",
      "default": 15
    },
    {
      "type": "header",
      "content": "Animation"
    },
    {
      "type": "range",
      "id": "animation_speed",
      "min": 0.2,
      "max": 1.0,
      "step": 0.1,
      "label": "Animation speed",
      "default": 0.5
    },
    {
      "type": "header",
      "content": "Default Image"
    },
    {
      "type": "paragraph",
      "content": "Shown when no details are open"
    },
    {
      "type": "image_picker",
      "id": "default_image",
      "label": "Default image"
    },
    {
      "type": "header",
      "content": "Feature 1"
    },
    {
      "type": "checkbox",
      "id": "feature_1_enabled",
      "label": "Enable feature 1",
      "default": true
    },
    {
      "type": "text",
      "id": "feature_1_title",
      "label": "Title",
      "default": "Details & Summary"
    },
    {
      "type": "richtext",
      "id": "feature_1_content",
      "label": "Content",
      "default": "<p>A built-in web platform disclosure, accessible by default â€” no JavaScript required.</p>"
    },
    {
      "type": "image_picker",
      "id": "feature_1_image",
      "label": "Feature image"
    },
    {
      "type": "header",
      "content": "Feature 2"
    },
    {
      "type": "checkbox",
      "id": "feature_2_enabled",
      "label": "Enable feature 2",
      "default": true
    },
    {
      "type": "text",
      "id": "feature_2_title",
      "label": "Title",
      "default": "Smooth Height"
    },
    {
      "type": "richtext",
      "id": "feature_2_content",
      "label": "Content",
      "default": "<p>Create smooth auto-to-open transitions on height with modern CSS.</p>"
    },
    {
      "type": "image_picker",
      "id": "feature_2_image",
      "label": "Feature image"
    },
    {
      "type": "header",
      "content": "Feature 3"
    },
    {
      "type": "checkbox",
      "id": "feature_3_enabled",
      "label": "Enable feature 3",
      "default": true
    },
    {
      "type": "text",
      "id": "feature_3_title",
      "label": "Title",
      "default": "Timings"
    },
    {
      "type": "richtext",
      "id": "feature_3_content",
      "label": "Content",
      "default": "<p>Customize the animation timings to get that perfect bounce effect.</p>"
    },
    {
      "type": "image_picker",
      "id": "feature_3_image",
      "label": "Feature image"
    },
    {
      "type": "header",
      "content": "Feature 4"
    },
    {
      "type": "checkbox",
      "id": "feature_4_enabled",
      "label": "Enable feature 4",
      "default": true
    },
    {
      "type": "text",
      "id": "feature_4_title",
      "label": "Title",
      "default": "Progressive"
    },
    {
      "type": "richtext",
      "id": "feature_4_content",
      "label": "Content",
      "default": "<p>Start with plain markup and progressively enhance with animations.</p>"
    },
    {
      "type": "image_picker",
      "id": "feature_4_image",
      "label": "Feature image"
    },
    {
      "type": "header",
      "content": "Feature 5"
    },
    {
      "type": "checkbox",
      "id": "feature_5_enabled",
      "label": "Enable feature 5",
      "default": true
    },
    {
      "type": "text",
      "id": "feature_5_title",
      "label": "Title",
      "default": "Follow for more"
    },
    {
      "type": "richtext",
      "id": "feature_5_content",
      "label": "Content",
      "default": "<p>Discover more creative web experiments and tutorials.</p>"
    },
    {
      "type": "image_picker",
      "id": "feature_5_image",
      "label": "Feature image"
    },
    {
      "type": "header",
      "content": "Feature 6"
    },
    {
      "type": "checkbox",
      "id": "feature_6_enabled",
      "label": "Enable feature 6",
      "default": false
    },
    {
      "type": "text",
      "id": "feature_6_title",
      "label": "Title",
      "default": "Extra Feature"
    },
    {
      "type": "richtext",
      "id": "feature_6_content",
      "label": "Content",
      "default": "<p>Add your custom content here.</p>"
    },
    {
      "type": "image_picker",
      "id": "feature_6_image",
      "label": "Feature image"
    }
  ],
  "presets": [
    {
      "name": "Interactive Details Hero"
    }
  ]
}
{% endschema %}